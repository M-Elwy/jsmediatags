"use strict";function t(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:String(e)}function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}Object.defineProperty(exports,"__esModule",{value:!0});var n=-1,i=function(){function e(){this._fileData=void 0,this._fileData=[]}var r,i,o=e.prototype;return o.addData=function(t,e){var r=t+e.length-1,i=this._getChunkRange(t,r);if(i.startIx===n)this._fileData.splice(i.insertIx||0,0,{offset:t,data:e});else{var o=this._fileData[i.startIx],a=this._fileData[i.endIx],s=t>o.offset,u=r<a.offset+a.data.length-1,f={offset:Math.min(t,o.offset),data:e};if(s){var c=this._sliceData(o.data,0,t-o.offset);f.data=this._concatData(c,e)}u&&(c=this._sliceData(f.data,0,a.offset-f.offset),f.data=this._concatData(c,a.data)),this._fileData.splice(i.startIx,i.endIx-i.startIx+1,f)}},o._concatData=function(t,e){if("undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(t)){var r=new t.constructor(t.length+e.length);return r.set(t,0),r.set(e,t.length),r}return t.concat(e)},o._sliceData=function(t,e,r){return t.slice?t.slice(e,r):t.subarray(e,r)},o._getChunkRange=function(t,e){for(var r=n,i=n,o=0,a=0;a<this._fileData.length;o=++a){var s=(u=this._fileData[a].offset)+this._fileData[a].data.length;if(e<u-1)break;if(t<=s+1&&e>=u-1){r=a;break}}if(r===n)return{startIx:n,endIx:n,insertIx:o};for(a=r;a<this._fileData.length;a++){var u;if(e>=(u=this._fileData[a].offset)-1&&(i=a),e<=(s=u+this._fileData[a].data.length)+1)break}return i===n&&(i=r),{startIx:r,endIx:i}},o.hasDataRange=function(t,e){for(var r=0;r<this._fileData.length;r++){var n=this._fileData[r];if(e<n.offset)return!1;if(t>=n.offset&&e<n.offset+n.data.length)return!0}return!1},o.getByteAt=function(t){for(var e,r=0;r<this._fileData.length;r++){var n=this._fileData[r].offset;if(t>=n&&t<=n+this._fileData[r].data.length-1){e=this._fileData[r];break}}if(e)return e.data[t-e.offset];throw new Error("Offset "+t+" hasn't been loaded yet.")},r=e,(i=[{key:"NOT_FOUND",get:function(){return n}}])&&function(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}(r,i),Object.defineProperty(r,"prototype",{writable:!1}),e}(),o=function(){function t(t,e){this._value=void 0,this.bytesReadCount=void 0,this.length=void 0,this._value=t,this.bytesReadCount=e,this.length=t.length}return t.prototype.toString=function(){return this._value},t}(),a=function(t,e){var r=[];e=e||t.length;for(var n=0;n<e;){var i=t[n++];if(0==i)break;r[n-1]=String.fromCharCode(i)}return new o(r.join(""),n)},s=function(){function t(){this._isInitialized=void 0,this._size=void 0,this._isInitialized=!1,this._size=0}t.canReadFile=function(t){throw new Error("Must implement canReadFile function")};var e=t.prototype;return e.init=function(t){var e=this;if(!this._isInitialized)return this._init({onSuccess:function(){e._isInitialized=!0,t.onSuccess()},onError:t.onError});setTimeout(t.onSuccess,1)},e._init=function(t){throw new Error("Must implement init function")},e.loadRange=function(t,e){throw new Error("Must implement loadRange function")},e.getSize=function(){if(!this._isInitialized)throw new Error("init() must be called first.");return this._size},e.getByteAt=function(t){throw new Error("Must implement getByteAt function")},e.getBytesAt=function(t,e){for(var r=new Array(e),n=0;n<e;n++)r[n]=this.getByteAt(t+n);return r},e.isBitSetAt=function(t,e){return 0!=(this.getByteAt(t)&1<<e)},e.getSByteAt=function(t){var e=this.getByteAt(t);return e>127?e-256:e},e.getShortAt=function(t,e){var r=e?(this.getByteAt(t)<<8)+this.getByteAt(t+1):(this.getByteAt(t+1)<<8)+this.getByteAt(t);return r<0&&(r+=65536),r},e.getSShortAt=function(t,e){var r=this.getShortAt(t,e);return r>32767?r-65536:r},e.getLongAt=function(t,e){var r=this.getByteAt(t),n=this.getByteAt(t+1),i=this.getByteAt(t+2),o=this.getByteAt(t+3),a=e?(((r<<8)+n<<8)+i<<8)+o:(((o<<8)+i<<8)+n<<8)+r;return a<0&&(a+=4294967296),a},e.getSLongAt=function(t,e){var r=this.getLongAt(t,e);return r>2147483647?r-4294967296:r},e.getInteger24At=function(t,e){var r=this.getByteAt(t),n=this.getByteAt(t+1),i=this.getByteAt(t+2),o=e?((r<<8)+n<<8)+i:((i<<8)+n<<8)+r;return o<0&&(o+=16777216),o},e.getStringAt=function(t,e){for(var r=[],n=t,i=0;n<t+e;n++,i++)r[i]=String.fromCharCode(this.getByteAt(n));return r.join("")},e.getStringWithCharsetAt=function(t,e,r){var n,i=this.getBytesAt(t,e);switch((r||"").toLowerCase()){case"utf-16":case"utf-16le":case"utf-16be":n=function(t,e,r){var n=0,i=1,a=0;r=Math.min(r||t.length,t.length),254==t[0]&&255==t[1]?(e=!0,n=2):255==t[0]&&254==t[1]&&(e=!1,n=2),e&&(i=0,a=1);for(var s=[],u=0;n<r;u++){var f=t[n+i],c=(f<<8)+t[n+a];if(n+=2,0==c)break;if(f<216||f>=224)s[u]=String.fromCharCode(c);else{var g=t[n+i],d=t[n+a];n+=2,s[u]=String.fromCharCode(c,(g<<8)+d)}}return new o(s.join(""),n)}(i,"utf-16be"===r);break;case"utf-8":n=function(t,e){var r=0;e=Math.min(e||t.length,t.length),239==t[0]&&187==t[1]&&191==t[2]&&(r=3);for(var n=[],i=0;r<e;i++){var a=t[r++];if(0==a)break;if(a<128)n[i]=String.fromCharCode(a);else if(a>=194&&a<224){var s=t[r++];n[i]=String.fromCharCode(((31&a)<<6)+(63&s))}else if(a>=224&&a<240){s=t[r++];var u=t[r++];n[i]=String.fromCharCode(((255&a)<<12)+((63&s)<<6)+(63&u))}else if(a>=240&&a<245){var f=((7&a)<<18)+((63&(s=t[r++]))<<12)+((63&(u=t[r++]))<<6)+(63&t[r++])-65536;n[i]=String.fromCharCode(55296+(f>>10),56320+(1023&f))}}return new o(n.join(""),r)}(i);break;default:n=a(i)}return n},e.getCharAt=function(t){return String.fromCharCode(this.getByteAt(t))},e.getSynchsafeInteger32At=function(t){var e=this.getByteAt(t),r=this.getByteAt(t+1),n=this.getByteAt(t+2);return 127&this.getByteAt(t+3)|(127&n)<<7|(127&r)<<14|(127&e)<<21},t}(),u=function(t){function r(e){var r;return(r=t.call(this)||this)._url=void 0,r._fileData=void 0,r._url=e,r._fileData=new i,r}e(r,t),r.canReadFile=function(t){return"string"==typeof t&&/^[a-z]+:\/\//i.test(t)},r.setConfig=function(t){for(var e in t)t.hasOwnProperty(e)&&(this._config[e]=t[e]);for(var r=this._config.disallowedXhrHeaders,n=0;n<r.length;n++)r[n]=r[n].toLowerCase()};var n=r.prototype;return n._init=function(t){r._config.avoidHeadRequests?this._fetchSizeWithGetRequest(t):this._fetchSizeWithHeadRequest(t)},n._fetchSizeWithHeadRequest=function(t){var e=this;this._makeXHRRequest("HEAD",null,{onSuccess:function(r){var n=e._parseContentLength(r);n?(e._size=n,t.onSuccess()):e._fetchSizeWithGetRequest(t)},onError:t.onError})},n._fetchSizeWithGetRequest=function(t){var e=this,r=this._roundRangeToChunkMultiple([0,0]);this._makeXHRRequest("GET",r,{onSuccess:function(r){var n=e._parseContentRange(r),i=e._getXhrResponseContent(r);if(n){if(null==n.instanceLength)return void e._fetchEntireFile(t);e._size=n.instanceLength}else e._size=i.length;e._fileData.addData(0,i),t.onSuccess()},onError:t.onError})},n._fetchEntireFile=function(t){var e=this;this._makeXHRRequest("GET",null,{onSuccess:function(r){var n=e._getXhrResponseContent(r);e._size=n.length,e._fileData.addData(0,n),t.onSuccess()},onError:t.onError})},n._getXhrResponseContent=function(t){return t.response||t.responseText||""},n._parseContentLength=function(t){var e=this._getResponseHeader(t,"Content-Length");return null==e?e:parseInt(e,10)},n._parseContentRange=function(t){var e=this._getResponseHeader(t,"Content-Range");if(e){var r=e.match(/bytes (\d+)-(\d+)\/(?:(\d+)|\*)/i);if(!r)throw new Error("FIXME: Unknown Content-Range syntax: "+e);return{firstBytePosition:parseInt(r[1],10),lastBytePosition:parseInt(r[2],10),instanceLength:r[3]?parseInt(r[3],10):null}}return null},n.loadRange=function(t,e){var r=this;r._fileData.hasDataRange(t[0],Math.min(r._size,t[1]))?setTimeout(e.onSuccess,1):((t=this._roundRangeToChunkMultiple(t))[1]=Math.min(r._size,t[1]),this._makeXHRRequest("GET",t,{onSuccess:function(n){var i=r._getXhrResponseContent(n);r._fileData.addData(t[0],i),e.onSuccess()},onError:e.onError}))},n._roundRangeToChunkMultiple=function(t){var e=1024*Math.ceil((t[1]-t[0]+1)/1024);return[t[0],t[0]+e-1]},n._makeXHRRequest=function(t,e,n){var i=this._createXHRObject();i.open(t,this._url);var o=function(){200===i.status||206===i.status?n.onSuccess(i):n.onError&&n.onError({type:"xhr",info:"Unexpected HTTP status "+i.status+".",xhr:i}),i=null};void 0!==i.onload?(i.onload=o,i.onerror=function(){n.onError&&n.onError({type:"xhr",info:"Generic XHR error, check xhr object.",xhr:i})}):i.onreadystatechange=function(){4===i.readyState&&o()},r._config.timeoutInSec&&(i.timeout=1e3*r._config.timeoutInSec,i.ontimeout=function(){n.onError&&n.onError({type:"xhr",info:"Timeout after "+i.timeout/1e3+"s. Use jsmediatags.Config.setXhrTimeout to override.",xhr:i})}),i.overrideMimeType("text/plain; charset=x-user-defined"),e&&this._setRequestHeader(i,"Range","bytes="+e[0]+"-"+e[1]),this._setRequestHeader(i,"If-Modified-Since","Sat, 01 Jan 1970 00:00:00 GMT"),i.send(null)},n._setRequestHeader=function(t,e,n){r._config.disallowedXhrHeaders.indexOf(e.toLowerCase())<0&&t.setRequestHeader(e,n)},n._hasResponseHeader=function(t,e){var r=t.getAllResponseHeaders();if(!r)return!1;for(var n=r.split("\r\n"),i=[],o=0;o<n.length;o++)i[o]=n[o].split(":")[0].toLowerCase();return i.indexOf(e.toLowerCase())>=0},n._getResponseHeader=function(t,e){return this._hasResponseHeader(t,e)?t.getResponseHeader(e):null},n.getByteAt=function(t){return 255&this._fileData.getByteAt(t).charCodeAt(0)},n._createXHRObject=function(){if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;throw new Error("XMLHttpRequest is not supported")},r}(s);u._config=void 0,u._config={avoidHeadRequests:!1,disallowedXhrHeaders:[],timeoutInSec:30};var f=function(t){function r(e){var r;return(r=t.call(this)||this)._blob=void 0,r._fileData=void 0,r._blob=e,r._fileData=new i,r}e(r,t),r.canReadFile=function(t){return"undefined"!=typeof Blob&&t instanceof Blob||"undefined"!=typeof File&&t instanceof File};var n=r.prototype;return n._init=function(t){this._size=this._blob.size,setTimeout(t.onSuccess,1)},n.loadRange=function(t,e){var r=this,n=this._blob.slice.call(this._blob,t[0],t[1]+1),i=new FileReader;i.onloadend=function(n){var o=new Uint8Array(i.result);r._fileData.addData(t[0],o),e.onSuccess()},i.onerror=i.onabort=function(t){e.onError&&e.onError({type:"blob",info:i.error})},i.readAsArrayBuffer(n)},n.getByteAt=function(t){return this._fileData.getByteAt(t)},r}(s),c=function(t){function r(e){var r;return(r=t.call(this)||this)._array=void 0,r._size=void 0,r._array=e,r._size=e.length,r._isInitialized=!0,r}e(r,t),r.canReadFile=function(t){return Array.isArray(t)||"function"==typeof Buffer&&Buffer.isBuffer(t)};var n=r.prototype;return n.init=function(t){setTimeout(t.onSuccess,0)},n.loadRange=function(t,e){setTimeout(e.onSuccess,0)},n.getByteAt=function(t){if(t>=this._array.length)throw new Error("Offset "+t+" hasn't been loaded yet.");return this._array[t]},r}(s),g=function(){function t(t){this._mediaFileReader=void 0,this._tags=void 0,this._mediaFileReader=t,this._tags=null}t.getTagIdentifierByteRange=function(){throw new Error("Must implement")},t.canReadTagFormat=function(t){throw new Error("Must implement")};var e=t.prototype;return e.setTagsToRead=function(t){return this._tags=t,this},e.read=function(t){var e=this;this._mediaFileReader.init({onSuccess:function(){e._loadData(e._mediaFileReader,{onSuccess:function(){try{var r=e._parseData(e._mediaFileReader,e._tags)}catch(e){if(t.onError)return void t.onError({type:"parseData",info:e.message})}t.onSuccess(r)},onError:t.onError})},onError:t.onError})},e.getShortcuts=function(){return{}},e._loadData=function(t,e){throw new Error("Must implement _loadData function")},e._parseData=function(t,e){throw new Error("Must implement _parseData function")},e._expandShortcutTags=function(t){if(!t)return null;for(var e,r=[],n=this.getShortcuts(),i=0;e=t[i];i++)r=r.concat(n[e]||[e]);return r},t}(),d=function(t){function r(){return t.apply(this,arguments)||this}e(r,t),r.getTagIdentifierByteRange=function(){return{offset:-128,length:128}},r.canReadTagFormat=function(t){return"TAG"===String.fromCharCode.apply(String,t.slice(0,3))};var n=r.prototype;return n._loadData=function(t,e){var r=t.getSize();t.loadRange([r-128,r-1],e)},n._parseData=function(t,e){var r=t.getSize()-128,n=t.getStringWithCharsetAt(r+3,30).toString(),i=t.getStringWithCharsetAt(r+33,30).toString(),o=t.getStringWithCharsetAt(r+63,30).toString(),a=t.getStringWithCharsetAt(r+93,4).toString(),s=t.getByteAt(r+97+28),u=t.getByteAt(r+97+29);if(0==s&&0!=u)var f="1.1",c=t.getStringWithCharsetAt(r+97,28).toString();else f="1.0",c=t.getStringWithCharsetAt(r+97,30).toString(),u=0;var g=t.getByteAt(r+97+30);if(g<255)var d=l[g];else d="";var h={type:"ID3",version:f,tags:{title:n,artist:i,album:o,year:a,comment:c,genre:d}};return u&&(h.tags.track=u),h},r}(g),l=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk-Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","Acapella","Euro-House","Dance Hall"],h={},p={BUF:"Recommended buffer size",CNT:"Play counter",COM:"Comments",CRA:"Audio encryption",CRM:"Encrypted meta frame",ETC:"Event timing codes",EQU:"Equalization",GEO:"General encapsulated object",IPL:"Involved people list",LNK:"Linked information",MCI:"Music CD Identifier",MLL:"MPEG location lookup table",PIC:"Attached picture",POP:"Popularimeter",REV:"Reverb",RVA:"Relative volume adjustment",SLT:"Synchronized lyric/text",STC:"Synced tempo codes",TAL:"Album/Movie/Show title",TBP:"BPM (Beats Per Minute)",TCM:"Composer",TCO:"Content type",TCR:"Copyright message",TDA:"Date",TDY:"Playlist delay",TEN:"Encoded by",TFT:"File type",TIM:"Time",TKE:"Initial key",TLA:"Language(s)",TLE:"Length",TMT:"Media type",TOA:"Original artist(s)/performer(s)",TOF:"Original filename",TOL:"Original Lyricist(s)/text writer(s)",TOR:"Original release year",TOT:"Original album/Movie/Show title",TP1:"Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group",TP2:"Band/Orchestra/Accompaniment",TP3:"Conductor/Performer refinement",TP4:"Interpreted, remixed, or otherwise modified by",TPA:"Part of a set",TPB:"Publisher",TRC:"ISRC (International Standard Recording Code)",TRD:"Recording dates",TRK:"Track number/Position in set",TSI:"Size",TSS:"Software/hardware and settings used for encoding",TT1:"Content group description",TT2:"Title/Songname/Content description",TT3:"Subtitle/Description refinement",TXT:"Lyricist/text writer",TXX:"User defined text information frame",TYE:"Year",UFI:"Unique file identifier",ULT:"Unsychronized lyric/text transcription",WAF:"Official audio file webpage",WAR:"Official artist/performer webpage",WAS:"Official audio source webpage",WCM:"Commercial information",WCP:"Copyright/Legal information",WPB:"Publishers official webpage",WXX:"User defined URL link frame",AENC:"Audio encryption",APIC:"Attached picture",ASPI:"Audio seek point index",CHAP:"Chapter",CTOC:"Table of contents",COMM:"Comments",COMR:"Commercial frame",ENCR:"Encryption method registration",EQU2:"Equalisation (2)",EQUA:"Equalization",ETCO:"Event timing codes",GEOB:"General encapsulated object",GRID:"Group identification registration",IPLS:"Involved people list",LINK:"Linked information",MCDI:"Music CD identifier",MLLT:"MPEG location lookup table",OWNE:"Ownership frame",PRIV:"Private frame",PCNT:"Play counter",POPM:"Popularimeter",POSS:"Position synchronisation frame",RBUF:"Recommended buffer size",RVA2:"Relative volume adjustment (2)",RVAD:"Relative volume adjustment",RVRB:"Reverb",SEEK:"Seek frame",SYLT:"Synchronized lyric/text",SYTC:"Synchronized tempo codes",TALB:"Album/Movie/Show title",TBPM:"BPM (beats per minute)",TCOM:"Composer",TCON:"Content type",TCOP:"Copyright message",TDAT:"Date",TDLY:"Playlist delay",TDRC:"Recording time",TDRL:"Release time",TDTG:"Tagging time",TENC:"Encoded by",TEXT:"Lyricist/Text writer",TFLT:"File type",TIME:"Time",TIPL:"Involved people list",TIT1:"Content group description",TIT2:"Title/songname/content description",TIT3:"Subtitle/Description refinement",TKEY:"Initial key",TLAN:"Language(s)",TLEN:"Length",TMCL:"Musician credits list",TMED:"Media type",TMOO:"Mood",TOAL:"Original album/movie/show title",TOFN:"Original filename",TOLY:"Original lyricist(s)/text writer(s)",TOPE:"Original artist(s)/performer(s)",TORY:"Original release year",TOWN:"File owner/licensee",TPE1:"Lead performer(s)/Soloist(s)",TPE2:"Band/orchestra/accompaniment",TPE3:"Conductor/performer refinement",TPE4:"Interpreted, remixed, or otherwise modified by",TPOS:"Part of a set",TPRO:"Produced notice",TPUB:"Publisher",TRCK:"Track number/Position in set",TRDA:"Recording dates",TRSN:"Internet radio station name",TRSO:"Internet radio station owner",TSOA:"Album sort order",TSOP:"Performer sort order",TSOT:"Title sort order",TSIZ:"Size",TSRC:"ISRC (international standard recording code)",TSSE:"Software/Hardware and settings used for encoding",TSST:"Set subtitle",TYER:"Year",TXXX:"User defined text information frame",UFID:"Unique file identifier",USER:"Terms of use",USLT:"Unsychronized lyric/text transcription",WCOM:"Commercial information",WCOP:"Copyright/Legal information",WOAF:"Official audio file webpage",WOAR:"Official artist/performer webpage",WOAS:"Official audio source webpage",WORS:"Official internet radio station homepage",WPAY:"Payment",WPUB:"Publishers official webpage",WXXX:"User defined URL link frame"},m=function(){function t(){}return t.getFrameReaderFunction=function(t){return t in h?h[t]:"T"===t[0]?h["T*"]:"W"===t[0]?h["W*"]:null},t.readFrames=function(e,r,n,i,o){for(var a={},s=this._getFrameHeaderSize(i);e<r-s;){var u=this._readFrameHeader(n,e,i),f=u.id;if(!f)break;var c=u.flags,g=u.size,d=e+u.headerSize,l=n;if(e+=u.headerSize+u.size,!o||-1!==o.indexOf(f)){if("MP3e"===f||"\0MP3"===f||"\0\0MP"===f||" MP3"===f)break;c&&c.format.unsynchronisation&&!i.flags.unsynchronisation&&(l=this.getUnsyncFileReader(l,d,g),d=0,g=l.getSize()),c&&c.format.data_length_indicator&&(d+=4,g-=4);var h=t.getFrameReaderFunction(f),p=h?h.apply(this,[d,g,l,c,i]):null,m={id:f,size:g,description:this._getFrameDescription(f),data:p};f in a?(a[f].id&&(a[f]=[a[f]]),a[f].push(m)):a[f]=m}}return a},t._getFrameHeaderSize=function(t){var e=t.major;return 2==e?6:3==e||4==e?10:0},t._readFrameHeader=function(t,e,r){var n=r.major,i=null,o=this._getFrameHeaderSize(r);switch(n){case 2:var a=t.getStringAt(e,3),s=t.getInteger24At(e+3,!0);break;case 3:a=t.getStringAt(e,4),s=t.getLongAt(e+4,!0);break;case 4:a=t.getStringAt(e,4),s=t.getSynchsafeInteger32At(e+4)}return a!=String.fromCharCode(0,0,0)&&a!=String.fromCharCode(0,0,0,0)||(a=""),a&&n>2&&(i=this._readFrameFlags(t,e+8)),{id:a||"",size:s||0,headerSize:o||0,flags:i}},t._readFrameFlags=function(t,e){return{message:{tag_alter_preservation:t.isBitSetAt(e,6),file_alter_preservation:t.isBitSetAt(e,5),read_only:t.isBitSetAt(e,4)},format:{grouping_identity:t.isBitSetAt(e+1,7),compression:t.isBitSetAt(e+1,3),encryption:t.isBitSetAt(e+1,2),unsynchronisation:t.isBitSetAt(e+1,1),data_length_indicator:t.isBitSetAt(e+1,0)}}},t._getFrameDescription=function(t){return t in p?p[t]:"Unknown"},t.getUnsyncFileReader=function(t,e,r){for(var n=t.getBytesAt(e,r),i=0;i<n.length-1;i++)255===n[i]&&0===n[i+1]&&n.splice(i+1,1);return new c(n)},t}();function v(t){var e;switch(t){case 0:default:e="iso-8859-1";break;case 1:e="utf-16";break;case 2:e="utf-16be";break;case 3:e="utf-8"}return e}function y(t,e,r,n){var i=r.getStringWithCharsetAt(t+1,e-1,n),o=r.getStringWithCharsetAt(t+1+i.bytesReadCount,e-1-i.bytesReadCount,n);return{user_description:i.toString(),data:o.toString()}}h.APIC=function(t,e,r,n,i){var o=t,a=v(r.getByteAt(t));switch(i&&i.major){case 2:var s=r.getStringAt(t+1,3);t+=4;break;case 3:case 4:t+=1+(s=r.getStringWithCharsetAt(t+1,e-1)).bytesReadCount;break;default:throw new Error("Couldn't read ID3v2 major version.")}var u=r.getByteAt(t),f=S[u],c=r.getStringWithCharsetAt(t+1,e-(t-o)-1,a);return t+=1+c.bytesReadCount,{format:s.toString(),type:f,description:c.toString(),data:r.getBytesAt(t,o+e-t)}},h.CHAP=function(t,e,r,n,i){var o=t,s={},u=a(r.getBytesAt(t,e));return s.id=u.toString(),s.startTime=r.getLongAt(t+=u.bytesReadCount,!0),s.endTime=r.getLongAt(t+=4,!0),s.startOffset=r.getLongAt(t+=4,!0),s.endOffset=r.getLongAt(t+=4,!0),s.subFrames=this.readFrames(t+=4,t+(e-(t-o)),r,i),s},h.CTOC=function(t,e,r,n,i){var o=t,s={childElementIds:[],id:void 0,topLevel:void 0,ordered:void 0,entryCount:void 0,subFrames:void 0},u=a(r.getBytesAt(t,e));s.id=u.toString(),s.topLevel=r.isBitSetAt(t+=u.bytesReadCount,1),s.ordered=r.isBitSetAt(t,0),t++,s.entryCount=r.getByteAt(t),t++;for(var f=0;f<s.entryCount;f++){var c=a(r.getBytesAt(t,e-(t-o)));s.childElementIds.push(c.toString()),t+=c.bytesReadCount}return s.subFrames=this.readFrames(t,t+(e-(t-o)),r,i),s},h.COMM=function(t,e,r,n,i){var o=t,a=v(r.getByteAt(t)),s=r.getStringAt(t+1,3),u=r.getStringWithCharsetAt(t+4,e-4,a),f=r.getStringWithCharsetAt(t+=4+u.bytesReadCount,o+e-t,a);return{language:s,short_description:u.toString(),text:f.toString()}},h.COM=h.COMM,h.PIC=function(t,e,r,n,i){return h.APIC(t,e,r,n,i)},h.PCNT=function(t,e,r,n,i){return r.getLongAt(t,!1)},h.CNT=h.PCNT,h["T*"]=function(t,e,r,n,i){var o=v(r.getByteAt(t));return r.getStringWithCharsetAt(t+1,e-1,o).toString()},h.TXXX=function(t,e,r,n,i){var o=v(r.getByteAt(t));return y(t,e,r,o)},h.WXXX=function(t,e,r,n,i){if(0===e)return null;var o=v(r.getByteAt(t));return y(t,e,r,o)},h["W*"]=function(t,e,r,n,i){return 0===e?null:r.getStringWithCharsetAt(t,e,"iso-8859-1").toString()},h.TCON=function(t,e,r,n){return h["T*"].apply(this,arguments).replace(/^\(\d+\)/,"")},h.TCO=h.TCON,h.USLT=function(t,e,r,n,i){var o=t,a=v(r.getByteAt(t)),s=r.getStringAt(t+1,3),u=r.getStringWithCharsetAt(t+4,e-4,a),f=r.getStringWithCharsetAt(t+=4+u.bytesReadCount,o+e-t,a);return{language:s,descriptor:u.toString(),lyrics:f.toString()}},h.ULT=h.USLT,h.UFID=function(t,e,r,n,i){var o=a(r.getBytesAt(t,e)),s=r.getBytesAt(t+=o.bytesReadCount,e-o.bytesReadCount);return{ownerIdentifier:o.toString(),identifier:s}};var S=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],A=function(t){function r(){return t.apply(this,arguments)||this}e(r,t),r.getTagIdentifierByteRange=function(){return{offset:0,length:10}},r.canReadTagFormat=function(t){return"ID3"===String.fromCharCode.apply(String,t.slice(0,3))};var n=r.prototype;return n._loadData=function(t,e){t.loadRange([6,9],{onSuccess:function(){t.loadRange([0,10+t.getSynchsafeInteger32At(6)-1],e)},onError:e.onError})},n._parseData=function(t,e){var r=0,n=t.getByteAt(r+3);if(n>4)return{type:"ID3",version:">2.4",tags:{}};var i=t.getByteAt(r+4),o=t.isBitSetAt(r+5,7),a=t.isBitSetAt(r+5,6),s=t.isBitSetAt(r+5,5),u=t.getSynchsafeInteger32At(r+6);r+=10,a&&(r+=4===n?t.getSynchsafeInteger32At(r):t.getLongAt(r,!0)+4);var f={type:"ID3",version:"2."+n+"."+i,major:n,revision:i,flags:{unsynchronisation:o,extended_header:a,experimental_indicator:s,footer_present:!1},size:u,tags:{}};if(e)var c=this._expandShortcutTags(e);var g=u+10;f.flags.unsynchronisation&&(t=m.getUnsyncFileReader(t,r,u),r=0,g=t.getSize());var d=m.readFrames(r,g,t,f,c);for(var l in T)if(T.hasOwnProperty(l)){var h=this._getFrameData(d,T[l]);h&&(f.tags[l]=h)}for(var p in d)d.hasOwnProperty(p)&&(f.tags[p]=d[p]);return f},n._getFrameData=function(t,e){for(var r,n=0;r=e[n];n++)if(r in t)return(t[r]instanceof Array?t[r][0]:t[r]).data},n.getShortcuts=function(){return T},r}(g),T={title:["TIT2","TT2"],artist:["TPE1","TP1"],album:["TALB","TAL"],year:["TYER","TYE"],comment:["COMM","COM"],track:["TRCK","TRK"],genre:["TCON","TCO"],picture:["APIC","PIC"],lyrics:["USLT","ULT"]},R=function(t){function r(){return t.apply(this,arguments)||this}e(r,t),r.getTagIdentifierByteRange=function(){return{offset:0,length:16}},r.canReadTagFormat=function(t){return"ftyp"===String.fromCharCode.apply(String,t.slice(4,8))};var n=r.prototype;return n._loadData=function(t,e){var r=this;t.loadRange([0,16],{onSuccess:function(){r._loadAtom(t,0,"",e)},onError:e.onError})},n._loadAtom=function(t,e,r,n){if(e>=t.getSize())n.onSuccess();else{var i=this,o=t.getLongAt(e,!0);if(0==o||isNaN(o))n.onSuccess();else{var a=t.getStringAt(e+4,4);if(this._isContainerAtom(a)){"meta"==a&&(e+=4);var s=(r?r+".":"")+a;"moov.udta.meta.ilst"===s?t.loadRange([e,e+o],n):t.loadRange([e+8,e+8+8],{onSuccess:function(){i._loadAtom(t,e+8,s,n)},onError:n.onError})}else t.loadRange([e+o,e+o+8],{onSuccess:function(){i._loadAtom(t,e+o,r,n)},onError:n.onError})}}},n._isContainerAtom=function(t){return["moov","udta","meta","ilst"].indexOf(t)>=0},n._canReadAtom=function(t){return!0},n._parseData=function(t,e){var r={};for(var n in e=this._expandShortcutTags(e),this._readAtom(r,t,0,t.getSize(),e),b)if(b.hasOwnProperty(n)){var i=r[b[n]];i&&(r[n]="track"===n?i.data.track:i.data)}return{type:"MP4",ftyp:t.getStringAt(8,4),version:t.getLongAt(12,!0),tags:r}},n._readAtom=function(t,e,r,n,i,o,a){a=void 0===a?"":a+"  ";for(var s=r;s<r+n;){var u=e.getLongAt(s,!0);if(0==u)return;var f=e.getStringAt(s+4,4);if(this._isContainerAtom(f))return"meta"==f&&(s+=4),void this._readAtom(t,e,s+8,u-8,i,(o?o+".":"")+f,a);if((!i||i.indexOf(f)>=0)&&"moov.udta.meta.ilst"===o&&this._canReadAtom(f))if("----"===f){var c=this._readMeanMetadataAtom(e,s);t[c.id]=c}else t[f]=this._readMetadataAtom(e,s);s+=u}},n._readMetadataAtom=function(t,e){var r=t.getLongAt(e,!0),n=t.getStringAt(e+4,4),i=t.getInteger24At(e+16+1,!0),o=_[i],a=!0;if("trkn"==n)s={track:t.getShortAt(e+16+10,a),total:t.getShortAt(e+16+14,a)};else if("disk"==n)s={disk:t.getShortAt(e+16+10,a),total:t.getShortAt(e+16+14,a)};else{var s,u=e+24,f=r-24;switch("covr"===n&&"uint8"===o&&(o="jpeg"),o){case"text":s=t.getStringWithCharsetAt(u,f,"utf-8").toString();break;case"uint8":s=t.getShortAt(u,!1);break;case"int":case"uint":s=("int"==o?1==f?t.getSByteAt:2==f?t.getSShortAt:4==f?t.getSLongAt:t.getLongAt:1==f?t.getByteAt:2==f?t.getShortAt:t.getLongAt).call(t,u+(8==f?4:0),!0);break;case"jpeg":case"png":s={format:"image/"+o,data:t.getBytesAt(u,f)}}}return{id:n,size:r,start:e,description:C[n]||"Unknown",data:s}},n._readMeanMetadataAtom=function(t,e){var r=t.getLongAt(e,!0),n=t.getStringAt(e+4,4),i="";if(t.getInteger24At(e+16+1,!0),"----"==n){var o=n,a=e+8;if(r=t.getLongAt(a,!0),o+="/"+(n=t.getStringAt(a+4,4)),"mean"===n&&(o+="/"+(n=t.getStringAt((a+=8)+4,r-12)),r=t.getLongAt(a=e+r+8,!0),"name"===(n=t.getStringAt(a+4,4))))return o+="/"+(n=t.getStringAt(a+12,r-12)),i=n,r=t.getLongAt(a+=r,!0),n=t.getStringAt(a+4,4),{id:o,size:r,start:e,description:i,data:t.getStringWithCharsetAt(a+16,r-16,"utf-8").toString()}}},n.getShortcuts=function(){return b},r}(g),_={0:"uint8",1:"text",13:"jpeg",14:"png",21:"int",22:"uint"},C={"©alb":"Album","©ART":"Artist",aART:"Album Artist","©day":"Release Date","©nam":"Title","©gen":"Genre",gnre:"Genre",trkn:"Track Number","©wrt":"Composer","©too":"Encoding Tool","©enc":"Encoded By",cprt:"Copyright",covr:"Cover Art","©grp":"Grouping",keyw:"Keywords","©lyr":"Lyrics","©cmt":"Comment",tmpo:"Tempo",cpil:"Compilation",disk:"Disc Number",tvsh:"TV Show Name",tven:"TV Episode ID",tvsn:"TV Season",tves:"TV Episode",tvnn:"TV Network",desc:"Description",ldes:"Long Description",sonm:"Sort Name",soar:"Sort Artist",soaa:"Sort Album",soco:"Sort Composer",sosn:"Sort Show",purd:"Purchase Date",pcst:"Podcast",purl:"Podcast URL",catg:"Category",hdvd:"HD Video",stik:"Media Type",rtng:"Content Rating",pgap:"Gapless Playback",apID:"Purchase Account",sfID:"Country Code",atID:"Artist ID",cnID:"Catalog ID",plID:"Collection ID",geID:"Genre ID","xid ":"Vendor Information",flvr:"Codec Flavor"},b={title:"©nam",artist:"©ART",album:"©alb",year:"©day",comment:"©cmt",track:"trkn",genre:"©gen",picture:"covr",lyrics:"©lyr"},B=[4,132],E=[6,134],D=["Other","32x32 pixels 'file icon' (PNG only)","Other file icon","Cover (front)","Cover (back)","Leaflet page","Media (e.g. label side of CD)","Lead artist/lead performer/soloist","Artist/performer","Conductor","Band/Orchestra","Composer","Lyricist/text writer","Recording Location","During recording","During performance","Movie/video screen capture","A bright coloured fish","Illustration","Band/artist logotype","Publisher/Studio logotype"],I=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))||this)._commentOffset=void 0,e._pictureOffset=void 0,e}e(r,t),r.getTagIdentifierByteRange=function(){return{offset:0,length:4}},r.canReadTagFormat=function(t){return"fLaC"===String.fromCharCode.apply(String,t.slice(0,4))};var n=r.prototype;return n._loadData=function(t,e){var r=this;t.loadRange([4,7],{onSuccess:function(){r._loadBlock(t,4,e)}})},n._loadBlock=function(t,e,r){var n=this,i=t.getByteAt(e),o=t.getInteger24At(e+1,!0);if(-1!==B.indexOf(i))t.loadRange([a=e+4,a+o],{onSuccess:function(){n._commentOffset=a,n._nextBlock(t,e,i,o,r)}});else if(-1!==E.indexOf(i)){var a;t.loadRange([a=e+4,a+o],{onSuccess:function(){n._pictureOffset=a,n._nextBlock(t,e,i,o,r)}})}else n._nextBlock(t,e,i,o,r)},n._nextBlock=function(t,e,r,n,i){var o=this;r>127?o._commentOffset?i.onSuccess():i.onError({type:"loadData",info:"Comment block could not be found."}):t.loadRange([e+4+n,e+4+4+n],{onSuccess:function(){o._loadBlock(t,e+4+n,i)}})},n._parseData=function(t,e){for(var r,n,i,o,a,s,u=t.getLongAt(this._commentOffset,!1)+(this._commentOffset+4),f=t.getLongAt(u,!1),c=u+4,g=0;g<f;g++){var d=t.getLongAt(c,!1),l=t.getStringWithCharsetAt(c+4,d,"utf-8").toString(),h=l.indexOf("="),p=[l.slice(0,h),l.slice(h+1)];switch(p[0].toUpperCase()){case"TITLE":r=p[1];break;case"ARTIST":n=p[1];break;case"ALBUM":i=p[1];break;case"TRACKNUMBER":o=p[1];break;case"GENRE":a=p[1]}c+=4+d}if(this._pictureOffset){var m=t.getLongAt(this._pictureOffset,!0),v=this._pictureOffset+4,y=t.getLongAt(v,!0),S=v+4,A=t.getStringAt(S,y),T=S+y,R=t.getLongAt(T,!0),_=T+4,C=t.getStringWithCharsetAt(_,R,"utf-8").toString(),b=_+R+16,B=t.getLongAt(b,!0),E=t.getBytesAt(b+4,B,!0);s={format:A,type:D[m],description:C,data:E}}return{type:"FLAC",version:"1",tags:{title:r,artist:n,album:i,track:o,genre:a,picture:s}}},r}(g),w=require("fs"),O=function(t){function r(e){var r;return(r=t.call(this)||this)._path=void 0,r._fileData=void 0,r._path=e,r._fileData=new i,r._isInitialized=!0,r}e(r,t),r.canReadFile=function(t){return"string"==typeof t&&!/^[a-z]+:\/\//i.test(t)};var n=r.prototype;return n.init=function(t){var e=this;w.stat(e._path,(function(r,n){r?t.onError&&t.onError({type:"fs",info:r}):(e._size=n.size,t.onSuccess())}))},n.loadRange=function(t,e){var r=-1,n=this._fileData,i=t[1]-t[0]+1,o=e.onSuccess,a=e.onError||function(t){};if(n.hasDataRange(t[0],t[1]))process.nextTick(o);else{var s=function(t,e,n){w.close(r,(function(t){t&&console.error(t)})),t?a({type:"fs",info:t}):(u(n),o())},u=function(e){var r=Array.prototype.slice.call(e,0,i);n.addData(t[0],r)};w.open(this._path,"r",void 0,(function(e,n){if(e)a({type:"fs",info:e});else{r=n;var o=Buffer.alloc(i);w.read(n,o,0,i,t[0],s)}}))}},n.getByteAt=function(t){return this._fileData.getByteAt(t)},r}(s),P=[],L=[];function k(t,e){return!(t.offset>=0&&t.offset+t.length>=e||t.offset<0&&(-t.offset>e||t.offset+t.length>0))}var M=function(){function t(t){this._file=void 0,this._tagsToRead=void 0,this._fileReader=void 0,this._tagReader=void 0,this._file=t}var e=t.prototype;return e.setTagsToRead=function(t){return this._tagsToRead=t,this},e.setFileReader=function(t){return this._fileReader=t,this},e.setTagReader=function(t){return this._tagReader=t,this},e.read=function(t){var e=new(this._getFileReader())(this._file),r=this;e.init({onSuccess:function(){r._getTagReader(e,{onSuccess:function(n){new n(e).setTagsToRead(r._tagsToRead).read(t)},onError:t.onError})},onError:t.onError})},e._getFileReader=function(){return this._fileReader?this._fileReader:this._findFileReader()},e._findFileReader=function(){for(var t=0;t<P.length;t++)if(P[t].canReadFile(this._file))return P[t];throw new Error("No suitable file reader found for "+this._file)},e._getTagReader=function(t,e){if(this._tagReader){var r=this._tagReader;setTimeout((function(){e.onSuccess(r)}),1)}else this._findTagReader(t,e)},e._findTagReader=function(t,e){for(var r=[],n=[],i=t.getSize(),o=0;o<L.length;o++){var a=L[o].getTagIdentifierByteRange();k(a,i)&&(a.offset>=0&&a.offset<i/2||a.offset<0&&a.offset<-i/2?r.push(L[o]):n.push(L[o]))}var s=!1,u={onSuccess:function(){if(s){for(var r=0;r<L.length;r++){var n=L[r].getTagIdentifierByteRange();if(k(n,i)){try{var o=t.getBytesAt(n.offset>=0?n.offset:n.offset+i,n.length)}catch(t){return void(e.onError&&e.onError({type:"fileReader",info:t.message}))}if(L[r].canReadTagFormat(o))return void e.onSuccess(L[r])}}e.onError&&e.onError({type:"tagFormat",info:"No suitable tag reader found"})}else s=!0},onError:e.onError};this._loadTagIdentifierRanges(t,r,u),this._loadTagIdentifierRanges(t,n,u)},e._loadTagIdentifierRanges=function(t,e,r){if(0!==e.length){for(var n=[Number.MAX_VALUE,0],i=t.getSize(),o=0;o<e.length;o++){var a=e[o].getTagIdentifierByteRange(),s=a.offset>=0?a.offset:a.offset+i,u=s+a.length-1;n[0]=Math.min(s,n[0]),n[1]=Math.max(u,n[1])}t.loadRange(n,r)}else setTimeout(r.onSuccess,1)},t}(),F=function(){function t(){}return t.addFileReader=function(e){return P.push(e),t},t.addTagReader=function(e){return L.push(e),t},t.removeTagReader=function(e){var r=L.indexOf(e);return r>=0&&L.splice(r,1),t},t.EXPERIMENTAL_avoidHeadRequests=function(){u.setConfig({avoidHeadRequests:!0})},t.setDisallowedXhrHeaders=function(t){u.setConfig({disallowedXhrHeaders:t})},t.setXhrTimeoutInSec=function(t){u.setConfig({timeoutInSec:t})},t}();if(F.addFileReader(u).addFileReader(f).addFileReader(c).addTagReader(A).addTagReader(d).addTagReader(R).addTagReader(I),"undefined"!=typeof process&&!process.browser){if("undefined"!=typeof navigator&&"ReactNative"===navigator.product)throw new Error("ReactNative not supported");F.addFileReader(O)}exports.Config=F,exports.Reader=M,exports.read=function(t,e){new M(t).read(e)};
//# sourceMappingURL=jsmediatags.cjs.production.min.js.map
